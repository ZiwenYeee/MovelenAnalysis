# Results

## Overall Trend
//To-do: Modified Label\

```{r , echo=FALSE,fig.width=6, fig.height=4}

library(data.table)
library(dplyr)
library(lubridate)
library(ggplot2)
library(tidyr)
library(reshape2)

rate = fread("../ml-25m/ratings.csv")
movie = fread("../ml-25m/movies.csv")


rate = merge(rate, movie, by = c("movieId"), all.x = TRUE)


rate$date = as.POSIXct(rate$timestamp, origin="1970-01-01", tz="GMT")
rate$date = as.Date(rate$date, "GMT")

rate$year = format(rate$date, format = "%Y")
rate = rate %>% filter(year > 1995)
rate_count = rate %>% group_by(year) %>% summarise(count = n(), mean_score = mean(rating))


scaleFactor <- max(rate_count$count) / max(rate_count$mean_score)

g = ggplot(rate_count) +
  geom_line(aes(x = year, y = count, group = 1)) +
  geom_line(aes(x = year, y = mean_score * scaleFactor, group = 1)) +
  ggtitle("Rating Trend & Count Trend") +
  labs (x = "Year", y = "Number") +
  theme_grey(16) +
  theme(legend.title = element_blank()) +
  scale_x_discrete(breaks = seq(1995, 2020, by = 3))
g




```


## Genre Exploration
//To-do: Modified Label\


```{r , echo=FALSE}
genres = rate %>% select(c("genres", "year", "rating")) %>% 
   mutate(genres =  strsplit(genres,split='|', fixed=TRUE)) %>%
   unnest(c(genres))
genres_count = genres %>% group_by(genres) %>% summarise(count = n(), mean_score = mean(rating)) %>%
  arrange(-count)

ggplot(data=genres_count, aes(x=count, y=reorder(genres, count))) +
    geom_bar(stat="identity")

rm(genres);invisible(gc())

```


## Popular Genre Year Analysis

```{r, echo = FALSE}

top_genres = genres_count[1:5, ]
selected_genres = c(top_genres$genres)

genres = rate %>% select(c("genres", "year", "rating")) %>% 
   mutate(genres =  strsplit(genres,split='|', fixed=TRUE)) %>%
   unnest(c(genres))

genres = genres %>% filter(genres %in% selected_genres)
genres = genres %>% filter(year > 1995)

genres_count = genres %>% group_by(year, genres) %>% summarise(count = n(), mean_score = mean(rating))

genres_count = genres_count[order(genres_count$genres, genres_count$year),]

ggplot(genres_count,) +
    geom_line( aes(year, count, group = 1)) +
    facet_grid(genres~.) +
  theme_grey(10) +
  theme(legend.title = element_blank()) +
  scale_x_discrete(breaks = seq(1995, 2020, by = 3))

rm(genres);invisible(gc())



```